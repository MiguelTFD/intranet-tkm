<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Seleccionar Ubicación</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>Seleccionar Ubicación</h1>

<!-- Formulario de selección -->
<form>
  <!-- Campo de selección de País -->
  <label for="pais">País:</label>
  <select id="pais" name="pais">
    <option value="">Seleccione un país</option>
    <option th:each="pais : ${paises}" th:value="${pais.id}" th:text="${pais.nombre_pais}"></option>
  </select>

  <!-- Campo de selección de Departamento (inicialmente vacío) -->
  <label for="departamento">Departamento:</label>
  <select id="departamento" name="departamento" disabled>
    <option value="">Seleccione un departamento</option>
  </select>

  <!-- Campo de selección de Provincia (inicialmente vacío) -->
  <label for="provincia">Provincia:</label>
  <select id="provincia" name="provincia" disabled>
    <option value="">Seleccione una provincia</option>
  </select>

  <!-- Campo de selección de Distrito(inicialmente vacío) -->
  <label for="distrito">Distrito:</label>
  <select id="distrito" name="distrito" disabled>
    <option value="">Seleccione un distrito</option>
  </select>
</form>

<script>
  $(document).ready(function() {

    // Cuando se selecciona un país
    $('#pais').on('change', function() {
      var paisId = $(this).val();
      if (paisId) {
        $.ajax({
          url: '/ubicacion/paises/' + paisId + '/departamentos',
          type: 'GET',
          success: function(data) {
            $('#departamento').empty().append('<option value="">Seleccione un departamento</option>');
            $('#departamento').prop('disabled', false);
            $.each(data, function(index, departamento) {
              $('#departamento').append('<option value="' + departamento.id + '">' + departamento.nombre_departamento + '</option>');
            });
          }
        });
      } else {
        $('#departamento').empty().append('<option value="">Seleccione un departamento</option>');
        $('#departamento').prop('disabled', true);
      }
    });

    // Cuando se selecciona un departamento
    $('#departamento').on('change', function() {
      var departamentoId = $(this).val();
      if (departamentoId) { // Asegúrate de que el ID no esté vacío
        $.ajax({
          url: '/ubicacion/departamentos/' + departamentoId + '/provincias',
          type: 'GET',
          success: function(data) {
            $('#provincia').empty().append('<option value="">Seleccione una provincia</option>');
            $('#provincia').prop('disabled', false);
            $.each(data, function(index, provincia) {
              $('#provincia').append('<option value="' + provincia.id + '">' + provincia.nombre_provincia + '</option>');
            });
          },
          error: function(xhr, status, error) {
            console.error("Error en la llamada AJAX: ", error);
          }
        });
      } else {
        $('#provincia').empty().append('<option value="">Seleccione una provincia</option>');
        $('#provincia').prop('disabled', true);
      }
    });

    // Cuando se selecciona uNA PROVINCAI
    $('#provincia').on('change', function() {
      var provinciaId = $(this).val();
      if (provinciaId) { // Asegúrate de que el ID no esté vacío
        $.ajax({
          url: '/ubicacion/provincias/' + provinciaId + '/distritos',
          type: 'GET',
          success: function(data) {
            $('#distrito').empty().append('<option value="">Seleccione un distrito</option>');
            $('#distrito').prop('disabled', false);
            $.each(data, function(index, distrito) {
              $('#distrito').append('<option value="' + distrito.id + '">' + distrito.nombre_distrito + '</option>');
            });
          },
          error: function(xhr, status, error) {
            console.error("Error en la llamada AJAX: ", error);
          }
        });
      } else {
        $('#distrito').empty().append('<option value="">Seleccione un distrito</option>');
        $('#distrito').prop('disabled', true);
      }
    });




  });
</script>
</body>
</html>
